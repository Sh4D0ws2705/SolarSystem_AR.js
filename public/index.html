<!DOCTYPE html>
<html>
  <head>
    <title>AR Solar System - Interactive</title>
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      .modal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
      }

      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin: 30% auto;
        width: 80%;
        max-width: 300px;
        text-align: center;
      }

      .close {
        float: right;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <!-- Modals -->
    <div id="planetModals">
      <!-- M·∫∑t Tr·ªùi -->
      <div id="modal-sun" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal-sun')">&times;</span>
          <h3>‚òÄ M·∫∑t Tr·ªùi - Ng√¥i sao trung t√¢m</h3>
          <p>
            Ng√¥i sao duy nh·∫•t trong h·ªá M·∫∑t Tr·ªùi, cung c·∫•p √°nh s√°ng v√† nƒÉng l∆∞·ª£ng
            cho c√°c h√†nh tinh quay quanh.
          </p>
        </div>
      </div>

      <!-- Sao Th·ªßy -->
      <div id="modal-mercury" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal-mercury')"
            >&times;</span
          >
          <h3>‚òø Sao Th·ªßy - H√†nh tinh s·ªë 1</h3>
          <p>
            G·∫ßn M·∫∑t Tr·ªùi nh·∫•t, kh√¥ng kh√≠ lo√£ng, quay quanh M·∫∑t Tr·ªùi ~88 ng√†y.
          </p>
        </div>
      </div>

      <!-- Sao Kim -->
      <div id="modal-venus" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal-venus')">&times;</span>
          <h3>‚ôÄ Sao Kim - H√†nh tinh s·ªë 2</h3>
          <p>R·∫•t n√≥ng, kh√≠ quy·ªÉn d√†y ƒë·∫∑c CO‚ÇÇ, quay ~225 ng√†y.</p>
        </div>
      </div>

      <!-- Tr√°i ƒê·∫•t -->
      <div id="modal-earth" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal-earth')">&times;</span>
          <h3>üåç Tr√°i ƒê·∫•t - H√†nh tinh s·ªë 3</h3>
          <p>
            H√†nh tinh duy nh·∫•t ƒë∆∞·ª£c bi·∫øt c√≥ s·ª± s·ªëng, quay quanh M·∫∑t Tr·ªùi ~365
            ng√†y. C√≥ m·ªôt v·ªá tinh t·ª± nhi√™n l√† M·∫∑t TrƒÉng.
          </p>
        </div>
      </div>

      <!-- Sao H·ªèa -->
      <div id="modal-mars" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal-mars')">&times;</span>
          <h3>‚ôÇ Sao H·ªèa - H√†nh tinh s·ªë 4</h3>
          <p>
            Kh√≠ h·∫≠u kh√¥ l·∫°nh, b·ªÅ m·∫∑t m√†u ƒë·ªè ƒë·∫∑c tr∆∞ng, quay quanh M·∫∑t Tr·ªùi ~687
            ng√†y.
          </p>
        </div>
      </div>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; sourceWidth: 1920; sourceHeight: 1080; displayWidth: 1920; displayHeight: 1080;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <!-- Camera ƒë·ªÉ t∆∞∆°ng t√°c -->
      <a-entity camera>
        <a-cursor raycaster="objects: .clickable" fuse="false"></a-cursor>
      </a-entity>
      <a-marker preset="hiro">
        <!-- Nh√≥m h·ªá m·∫∑t tr·ªùi c√≥ th·ªÉ xoay v√† zoom -->
        <a-entity
          id="solar-system"
          position="0 0 0"
          rotation="90 0 0"
          scale="1 1 1"
        >
          <!-- M·∫∑t Tr·ªùi -->
          <a-gltf-model
            src="./model/sun.glb"
            position="0 0.5 0"
            scale="0.03 0.03 0.03"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
            class="clickable"
          >
          </a-gltf-model>

          <!-- V√πng nh·∫•n ·∫©n ƒë·ªÉ m·ªü modal -->
          <a-sphere
            position="0 0.5 0"
            radius="0.4"
            color="yellow"
            opacity="0.5"
            class="clickable"
            id="sunButton"
          >
          </a-sphere>

          <!-- Sao Th·ªßy -->
          <a-entity
            position="0 0.5 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 8800"
          >
            <!-- Model Sao Th·ªßy -->
            <a-gltf-model
              src="./model/mercury.glb"
              position="0.6 0 0"
              scale="0.2 0.2 0.2"
              class="clickable"
            >
            </a-gltf-model>

            <!-- V√πng nh·∫•n ·∫©n ƒë·ªÉ m·ªü modal -->
            <a-sphere
              position="0.6 0 0"
              radius="0.25"
              color="yellow"
              opacity="0.5"
              class="clickable"
              id="mercuryButton"
            >
            </a-sphere>
          </a-entity>

          <!-- Sao Kim -->
          <a-entity
            position="0 0.5 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 22500"
          >
            <!-- Model Sao Kim -->
            <a-gltf-model
              src="./model/venus.glb"
              position="1.2 0 0"
              scale="0.002 0.002 0.002"
              class="clickable"
            >
            </a-gltf-model>

            <!-- V√πng nh·∫•n ·∫©n ƒë·ªÉ m·ªü modal -->
            <a-sphere
              position="1.2 0 0"
              radius="0.25"
              color="yellow"
              opacity="0.5"
              class="clickable"
              id="venusButton"
            >
            </a-sphere>
          </a-entity>

          <!-- Tr√°i ƒê·∫•t v√† M·∫∑t TrƒÉng -->
          <a-entity
            position="0 0.5 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 36500"
          >
            <!-- Tr√°i ƒê·∫•t -->
            <a-gltf-model
              src="./model/earth.glb"
              position="1.8 0 0"
              scale="0.00007 0.00007 0.00007"
              class="clickable"
              id="earthButton"
            >
            </a-gltf-model>

            <!-- M·∫∑t TrƒÉng quay quanh Tr√°i ƒê·∫•t -->
            <a-entity
              position="2 0 0"
              animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
            >
              <a-gltf-model
                src="./model/moon.glb"
                position="0.5 0 0"
                scale="0.02 0.02 0.02"
                rotation="0 90 0"
              >
              </a-gltf-model>
            </a-entity>
          </a-entity>

          <!-- Sao H·ªèa -->
          <a-entity
            position="0 0.5 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 68700"
          >
            <a-gltf-model
              src="./model/mars.glb"
              position="2.3 0 0"
              scale="0.25 0.25 0.25"
              class="clickable"
            >
            </a-gltf-model>

            <!-- V√πng nh·∫•n ·∫©n ƒë·ªÉ m·ªü modal -->
            <a-sphere
              position="2.3 0.35 0"
              radius="0.35"
              color="yellow"
              opacity="0.5"
              class="clickable"
              id="marsButton"
            >
            </a-sphere>
          </a-entity>

          <!-- Sao H·ªèa -->

          <!-- <a-entity
            position="0 0.5 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 68700"
          >
            <a-sphere position="1.8 0 0" radius="0.08" color="red"></a-sphere>
            <a-sphere
              position="1.8 0 0"
              radius="0.25"
              color="#fff"
              opacity="0.001"
              class="clickable"
              id="marsButton"
            ></a-sphere>
          </a-entity> -->
        </a-entity>
      </a-marker>
    </a-scene>

    <!-- Gesture logic (zoom + xoay) -->
    <script>
      AFRAME.registerComponent("gesture-handler", {
        init: function () {
          const el = this.el;
          let lastDist = null;
          let isDragging = false;
          let lastTouchX = 0;
          let lastTouchY = 0;

          const scaleLimit = { min: 0.3, max: 3 };

          el.sceneEl.canvas.addEventListener("touchstart", function (e) {
            if (e.touches.length === 2) {
              // Zoom
              const dx = e.touches[0].clientX - e.touches[1].clientX;
              const dy = e.touches[0].clientY - e.touches[1].clientY;
              lastDist = Math.sqrt(dx * dx + dy * dy);
            } else if (e.touches.length === 1) {
              // Xoay
              isDragging = true;
              lastTouchX = e.touches[0].clientX;
              lastTouchY = e.touches[0].clientY;
            }
          });

          el.sceneEl.canvas.addEventListener("touchmove", function (e) {
            if (e.touches.length === 2) {
              // Zoom
              const dx = e.touches[0].clientX - e.touches[1].clientX;
              const dy = e.touches[0].clientY - e.touches[1].clientY;
              const newDist = Math.sqrt(dx * dx + dy * dy);

              if (lastDist) {
                let scale = el.getAttribute("scale");
                const zoom = newDist / lastDist;
                scale.x = Math.min(
                  scaleLimit.max,
                  Math.max(scaleLimit.min, scale.x * zoom)
                );
                scale.y = Math.min(
                  scaleLimit.max,
                  Math.max(scaleLimit.min, scale.y * zoom)
                );
                scale.z = Math.min(
                  scaleLimit.max,
                  Math.max(scaleLimit.min, scale.z * zoom)
                );
                el.setAttribute("scale", scale);
              }

              lastDist = newDist;
            } else if (e.touches.length === 1 && isDragging) {
              // Xoay
              const currentX = e.touches[0].clientX;
              const currentY = e.touches[0].clientY;
              const deltaX = currentX - lastTouchX;
              const deltaY = currentY - lastTouchY;

              lastTouchX = currentX;
              lastTouchY = currentY;

              let rotation = el.getAttribute("rotation");
              rotation.y += deltaX * 0.5; // Xoay tr√°i-ph·∫£i
              rotation.x -= deltaY * 0.5; // Xoay l√™n-xu·ªëng (tr·ª´ ƒë·ªÉ xoay ƒë√∫ng h∆∞·ªõng)
              // rotation.x = Math.max(-90, Math.min(90, rotation.x));
              el.setAttribute("rotation", rotation);
            }
          });

          el.sceneEl.canvas.addEventListener("touchend", function (e) {
            if (e.touches.length < 2) {
              lastDist = null;
            }
            if (e.touches.length === 0) {
              isDragging = false;
            }
          });
        },
      });
    </script>

    <script>
      // G·∫Øn component gesture v√†o h·ªá m·∫∑t tr·ªùi
      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelector("#solar-system")
          .setAttribute("gesture-handler", "");

        const earthBtn = document.querySelector("#earthButton");
        const marsBtn = document.querySelector("#marsButton");
        const venusBtn = document.querySelector("#venusButton");
        const mercuryBtn = document.querySelector("#mercuryButton");
        const sunBtn = document.querySelector("#sunButton");

        earthBtn.addEventListener("click", () => {
          document.getElementById("modal-earth").style.display = "block";
        });

        sunBtn.addEventListener("click", () => {
          document.getElementById("modal-sun").style.display = "block";
        });

        marsBtn.addEventListener("click", () => {
          document.getElementById("modal-mars").style.display = "block";
        });

        venusBtn.addEventListener("click", () => {
          document.getElementById("modal-venus").style.display = "block";
        });

        mercuryBtn.addEventListener("click", () => {
          document.getElementById("modal-mercury").style.display = "block";
        });
      });

      // H√†m ƒë√≥ng modal
      function closeModal(id) {
        document.getElementById(id).style.display = "none";
      }
    </script>
  </body>
</html>
